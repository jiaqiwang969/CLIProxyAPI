<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebMCP å·¥å…·ç®¡ç† - CLIProxyAPI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .main-content {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .sidebar {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .quick-actions {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            flex: 0 0 250px;
        }

        .quick-actions h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }

        .action-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: #5568d3;
            transform: translateX(5px);
        }

        .action-btn.secondary {
            background: #f0f0f0;
            color: #333;
        }

        .action-btn.secondary:hover {
            background: #e0e0e0;
        }

        .content-area {
            flex: 1;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert.success {
            background: #c8e6c9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }

        .alert.error {
            background: #ffcdd2;
            color: #c62828;
            border-left: 4px solid #c62828;
        }

        .alert.info {
            background: #bbdefb;
            color: #1565c0;
            border-left: 4px solid #1565c0;
        }

        #webmcp-container {
            margin-top: 20px;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            font-size: 14px;
        }

        .footer a {
            color: white;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸš€ WebMCP å·¥å…·ç®¡ç†ç³»ç»Ÿ</h1>
            <p>å¼ºå¤§çš„å·¥å…·ç¼–æ’ã€å·¥ä½œæµç®¡ç†å’Œæ€§èƒ½ç›‘æ§å¹³å°</p>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="stat-tools">0</div>
                    <div class="stat-label">å·²æ³¨å†Œå·¥å…·</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-workflows">0</div>
                    <div class="stat-label">å·²å®šä¹‰å·¥ä½œæµ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-executions">0</div>
                    <div class="stat-label">æ‰§è¡Œè®°å½•</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-metrics">0</div>
                    <div class="stat-label">æ€§èƒ½æŒ‡æ ‡</div>
                </div>
            </div>
        </div>

        <!-- æç¤ºä¿¡æ¯ -->
        <div class="alert" id="alert-success"></div>
        <div class="alert" id="alert-error"></div>
        <div class="alert" id="alert-info"></div>

        <!-- ä¸»è¦å†…å®¹ -->
        <div style="display: flex; gap: 20px;">
            <!-- å¿«é€Ÿæ“ä½œ -->
            <div class="quick-actions">
                <h3>âš¡ å¿«é€Ÿæ“ä½œ</h3>
                <button class="action-btn" id="btn-init-examples">åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®</button>
                <button class="action-btn secondary" id="btn-export-data">å¯¼å‡ºæ•°æ®</button>
                <button class="action-btn secondary" id="btn-import-data">å¯¼å…¥æ•°æ®</button>
                <button class="action-btn secondary" id="btn-refresh-all">åˆ·æ–°æ‰€æœ‰æ•°æ®</button>
                <button class="action-btn secondary" id="btn-clear-cache">æ¸…ç©ºç¼“å­˜</button>
            </div>

            <!-- WebMCP å®¹å™¨ -->
            <div class="content-area">
                <div id="webmcp-container"></div>
            </div>
        </div>

        <!-- é¡µè„š -->
        <div class="footer">
            <p>WebMCP Dashboard Integration v1.0.0 |
                <a href="https://github.com/router-for-me/CLIProxyAPI" target="_blank">GitHub</a> |
                <a href="#" onclick="showDocumentation()">æ–‡æ¡£</a>
            </p>
        </div>
    </div>

    <!-- è„šæœ¬ -->
    <script src="/api/webmcp/dashboard/webmcp-dashboard-manager.js"></script>
    <script src="/api/webmcp/dashboard/webmcp-dashboard-ui.js"></script>
    <script src="/api/webmcp/dashboard/webmcp-examples.js"></script>

    <script>
        // åˆå§‹åŒ–
        let manager;
        let ui;

        async function init() {
            try {
                // åˆ›å»ºç®¡ç†å™¨
                manager = new WebMCPDashboardManager('/api/webmcp');

                // åˆ›å»ºUI
                ui = new WebMCPDashboardUI(manager, 'webmcp-container');

                // ç›‘å¬äº‹ä»¶
                manager.on('tools:loaded', updateStats);
                manager.on('workflows:loaded', updateStats);
                manager.on('executions:loaded', updateStats);
                manager.on('metrics:all-loaded', updateStats);
                manager.on('error', handleError);

                // ç»‘å®šæŒ‰é’®äº‹ä»¶
                document.getElementById('btn-init-examples').addEventListener('click', initializeExamples);
                document.getElementById('btn-export-data').addEventListener('click', exportData);
                document.getElementById('btn-import-data').addEventListener('click', importData);
                document.getElementById('btn-refresh-all').addEventListener('click', refreshAll);
                document.getElementById('btn-clear-cache').addEventListener('click', clearCache);

                // åŠ è½½åˆå§‹æ•°æ®
                await manager.listTools();

                showAlert('success', 'âœ“ WebMCP ç³»ç»Ÿå·²å°±ç»ªï¼');
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                showAlert('error', 'âœ— åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }

        function updateStats() {
            const stats = manager.getToolStats();
            document.getElementById('stat-tools').textContent = stats.totalTools;
            document.getElementById('stat-workflows').textContent = stats.totalWorkflows;
            document.getElementById('stat-executions').textContent = stats.totalExecutions;
            document.getElementById('stat-metrics').textContent = stats.metricsTracked;
        }

        async function initializeExamples() {
            try {
                showAlert('info', 'æ­£åœ¨åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®...');

                const examples = getExampleData();

                // æ³¨å†Œæ‰€æœ‰ç¤ºä¾‹å·¥å…·
                for (const tool of examples.tools) {
                    await manager.registerTool(tool);
                }

                // å®šä¹‰æ‰€æœ‰ç¤ºä¾‹å·¥ä½œæµ
                for (const workflow of examples.workflows) {
                    await manager.defineWorkflow(workflow);
                }

                // å®šä¹‰æ‰€æœ‰ç¤ºä¾‹æƒé™
                for (const permission of examples.permissions) {
                    await manager.definePermission(permission);
                }

                // åˆ·æ–°æ•°æ®
                await manager.listTools();
                await manager.listWorkflows();
                await manager.getAllMetrics();

                updateStats();
                showAlert('success', 'âœ“ ç¤ºä¾‹æ•°æ®åˆå§‹åŒ–æˆåŠŸï¼å·²åŠ è½½ ' + examples.tools.length + ' ä¸ªå·¥å…·å’Œ ' + examples.workflows.length + ' ä¸ªå·¥ä½œæµ');
            } catch (error) {
                console.error('åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®å¤±è´¥:', error);
                showAlert('error', 'âœ— åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }

        async function exportData() {
            try {
                const result = await manager.exportData();
                const dataStr = JSON.stringify(result.data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `webmcp-export-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                showAlert('success', 'âœ“ æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
            } catch (error) {
                console.error('å¯¼å‡ºå¤±è´¥:', error);
                showAlert('error', 'âœ— å¯¼å‡ºå¤±è´¥: ' + error.message);
            }
        }

        async function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async (e) => {
                try {
                    const file = e.target.files[0];
                    const text = await file.text();
                    const data = JSON.parse(text);
                    await manager.importData(data);
                    await manager.listTools();
                    await manager.listWorkflows();
                    updateStats();
                    showAlert('success', 'âœ“ æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                } catch (error) {
                    console.error('å¯¼å…¥å¤±è´¥:', error);
                    showAlert('error', 'âœ— å¯¼å…¥å¤±è´¥: ' + error.message);
                }
            };
            input.click();
        }

        async function refreshAll() {
            try {
                showAlert('info', 'æ­£åœ¨åˆ·æ–°æ‰€æœ‰æ•°æ®...');
                await manager.listTools();
                await manager.listWorkflows();
                await manager.listExecutions();
                await manager.getAllMetrics();
                updateStats();
                showAlert('success', 'âœ“ æ•°æ®åˆ·æ–°æˆåŠŸï¼');
            } catch (error) {
                console.error('åˆ·æ–°å¤±è´¥:', error);
                showAlert('error', 'âœ— åˆ·æ–°å¤±è´¥: ' + error.message);
            }
        }

        function clearCache() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç¼“å­˜å—ï¼Ÿ')) {
                manager.clearCache();
                updateStats();
                showAlert('success', 'âœ“ ç¼“å­˜å·²æ¸…ç©ºï¼');
            }
        }

        function handleError(error) {
            console.error('API é”™è¯¯:', error);
            showAlert('error', 'âœ— é”™è¯¯: ' + error.error);
        }

        function showAlert(type, message) {
            const alertId = `alert-${type}`;
            const alert = document.getElementById(alertId);
            alert.textContent = message;
            alert.classList.add('show');
            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        function showDocumentation() {
            alert(`WebMCP å·¥å…·ç®¡ç†ç³»ç»Ÿ - ä½¿ç”¨æŒ‡å—

1. å·¥å…·ç®¡ç†
   - æ³¨å†Œæ–°å·¥å…·ï¼šç‚¹å‡»"æ³¨å†Œæ–°å·¥å…·"æŒ‰é’®
   - æœç´¢å·¥å…·ï¼šä½¿ç”¨æœç´¢æ å’Œç±»åˆ«è¿‡æ»¤
   - æŸ¥çœ‹å·¥å…·è¯¦æƒ…ï¼šç‚¹å‡»å·¥å…·å¡ç‰‡

2. å·¥ä½œæµç®¡ç†
   - åˆ›å»ºå·¥ä½œæµï¼šç‚¹å‡»"åˆ›å»ºå·¥ä½œæµ"æŒ‰é’®
   - æ‰§è¡Œå·¥ä½œæµï¼šç‚¹å‡»å·¥ä½œæµå¡ç‰‡ä¸Šçš„"æ‰§è¡Œ"æŒ‰é’®
   - æŸ¥çœ‹æ‰§è¡Œè®°å½•ï¼šåˆ‡æ¢åˆ°"æ‰§è¡Œè®°å½•"æ ‡ç­¾é¡µ

3. æ€§èƒ½ç›‘æ§
   - æŸ¥çœ‹å·¥å…·æŒ‡æ ‡ï¼šåˆ‡æ¢åˆ°"æŒ‡æ ‡"æ ‡ç­¾é¡µ
   - ç›‘æ§æ‰§è¡Œæ€§èƒ½ï¼šæŸ¥çœ‹å¹³å‡è€—æ—¶ã€æˆåŠŸç‡ç­‰

4. æ•°æ®ç®¡ç†
   - å¯¼å‡ºæ•°æ®ï¼šç‚¹å‡»"å¯¼å‡ºæ•°æ®"æŒ‰é’®
   - å¯¼å…¥æ•°æ®ï¼šç‚¹å‡»"å¯¼å…¥æ•°æ®"æŒ‰é’®
   - åˆå§‹åŒ–ç¤ºä¾‹ï¼šç‚¹å‡»"åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®"æŒ‰é’®

æ›´å¤šä¿¡æ¯è¯·è®¿é—®ï¼šhttps://github.com/router-for-me/CLIProxyAPI`);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
