<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CLIProxy Manager</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3/dist/chart.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .glass {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .language-switch {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      gap: 8px;
    }

    .lang-btn {
      padding: 8px 16px;
      border-radius: 6px;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      font-size: 13px;
    }

    .lang-btn.active {
      background: #667eea;
      color: white;
    }

    .lang-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: all 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    .stat-label {
      color: #999;
      font-size: 13px;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-value {
      color: #667eea;
      font-size: 28px;
      font-weight: bold;
    }

    .header {
      background: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .header h1 {
      color: #667eea;
      font-size: 32px;
      margin-bottom: 8px;
    }

    .header p {
      color: #999;
      font-size: 16px;
    }

    .chart-container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .chart-container h2 {
      color: #667eea;
      font-size: 20px;
      margin-bottom: 20px;
    }

    .section-title {
      color: #667eea;
      font-size: 20px;
      margin-bottom: 20px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="language-switch">
    <button class="lang-btn active" onclick="switchLanguage('en')" id="btn-en">English</button>
    <button class="lang-btn" onclick="switchLanguage('zh')" id="btn-zh">‰∏≠Êñá</button>
  </div>

  <div class="p-8">
    <div class="max-w-7xl mx-auto">
      <!-- Header -->
      <div class="header">
        <h1 id="title">CLIProxy Manager</h1>
        <p id="subtitle">Real-time API usage monitoring and management</p>
      </div>

      <!-- Stats Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="stat-card">
          <div class="stat-label" id="label-total-tokens">Total Tokens</div>
          <div class="stat-value" id="total-tokens">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label" id="label-total-requests">Total Requests</div>
          <div class="stat-value" id="total-requests">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label" id="label-claude-models">Claude Models</div>
          <div class="stat-value" id="claude-models">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label" id="label-gemini-models">Gemini Models</div>
          <div class="stat-value" id="gemini-models">-</div>
        </div>
      </div>

      <!-- Usage Chart -->
      <div class="chart-container">
        <h2 id="chart-title">Usage Trends</h2>
        <canvas id="usageChart" height="80"></canvas>
      </div>

      <!-- System Status -->
      <div class="chart-container">
        <h2 id="status-title">System Status</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="stat-card">
            <div class="stat-label" id="label-auth-status">Authentication</div>
            <div class="stat-value" id="auth-status">-</div>
          </div>
          <div class="stat-card">
            <div class="stat-label" id="label-debug-mode">Debug Mode</div>
            <div class="stat-value" id="debug-mode">-</div>
          </div>
          <div class="stat-card">
            <div class="stat-label" id="label-stats-enabled">Statistics</div>
            <div class="stat-value" id="stats-enabled">-</div>
          </div>
          <div class="stat-card">
            <div class="stat-label" id="label-logging">Logging</div>
            <div class="stat-value" id="logging">-</div>
          </div>
        </div>
      </div>

      <!-- API Endpoints -->
      <div class="chart-container">
        <h2 id="api-title">API Endpoints</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="font-bold text-gray-700 mb-3" id="api-stats-title">Statistics</h3>
            <ul class="text-sm text-gray-600 space-y-2">
              <li>üìä <code class="bg-gray-100 px-2 py-1 rounded">GET /v0/management/usage</code></li>
              <li>üìà <code class="bg-gray-100 px-2 py-1 rounded">GET /v0/management/stats/trends</code></li>
              <li>üìù <code class="bg-gray-100 px-2 py-1 rounded">GET /v0/management/logs</code></li>
            </ul>
          </div>
          <div>
            <h3 class="font-bold text-gray-700 mb-3" id="api-keys-title">API Keys</h3>
            <ul class="text-sm text-gray-600 space-y-2">
              <li>üîë <code class="bg-gray-100 px-2 py-1 rounded">GET /v0/management/api-keys</code></li>
              <li>‚ûï <code class="bg-gray-100 px-2 py-1 rounded">PUT /v0/management/api-keys</code></li>
              <li>üóëÔ∏è <code class="bg-gray-100 px-2 py-1 rounded">DELETE /v0/management/api-keys</code></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Language translations
    const translations = {
      en: {
        title: 'CLIProxy Manager',
        subtitle: 'Real-time API usage monitoring and management',
        'label-total-tokens': 'Total Tokens',
        'label-total-requests': 'Total Requests',
        'label-claude-models': 'Claude Models',
        'label-gemini-models': 'Gemini Models',
        'chart-title': 'Usage Trends',
        'status-title': 'System Status',
        'label-auth-status': 'Authentication',
        'label-debug-mode': 'Debug Mode',
        'label-stats-enabled': 'Statistics',
        'label-logging': 'Logging',
        'api-title': 'API Endpoints',
        'api-stats-title': 'Statistics',
        'api-keys-title': 'API Keys',
        'enabled': '‚úÖ Enabled',
        'disabled': '‚ùå Disabled',
        'authenticated': '‚úÖ OK',
        'not-authenticated': '‚ùå Error'
      },
      zh: {
        title: 'CLIProxy ÁÆ°ÁêÜÂô®',
        subtitle: 'ÂÆûÊó∂ API ‰ΩøÁî®ÊÉÖÂÜµÁõëÊéßÂíåÁÆ°ÁêÜ',
        'label-total-tokens': 'ÊÄª Token Êï∞',
        'label-total-requests': 'ÊÄªËØ∑Ê±ÇÊï∞',
        'label-claude-models': 'Claude Ê®°Âûã',
        'label-gemini-models': 'Gemini Ê®°Âûã',
        'chart-title': '‰ΩøÁî®Ë∂ãÂäø',
        'status-title': 'Á≥ªÁªüÁä∂ÊÄÅ',
        'label-auth-status': 'ËÆ§ËØÅÁä∂ÊÄÅ',
        'label-debug-mode': 'Ë∞ÉËØïÊ®°Âºè',
        'label-stats-enabled': 'ÁªüËÆ°',
        'label-logging': 'Êó•Âøó',
        'api-title': 'API Á´ØÁÇπ',
        'api-stats-title': 'ÁªüËÆ°',
        'api-keys-title': 'API ÂØÜÈí•',
        'enabled': '‚úÖ ÂêØÁî®',
        'disabled': '‚ùå Á¶ÅÁî®',
        'authenticated': '‚úÖ Ê≠£Â∏∏',
        'not-authenticated': '‚ùå ÈîôËØØ'
      }
    };

    let currentLanguage = localStorage.getItem('language') || 'en';
    let usageChartInstance = null;

    function switchLanguage(lang) {
      currentLanguage = lang;
      localStorage.setItem('language', lang);

      // Update button states
      document.getElementById('btn-en').classList.toggle('active', lang === 'en');
      document.getElementById('btn-zh').classList.toggle('active', lang === 'zh');

      // Update all text elements
      updateLanguage();
      loadData();
    }

    function updateLanguage() {
      const t = translations[currentLanguage];
      for (const [key, value] of Object.entries(t)) {
        const element = document.getElementById(key);
        if (element) {
          element.textContent = value;
        }
      }
    }

    function t(key) {
      return translations[currentLanguage][key] || key;
    }

    async function loadData() {
      try {
        const response = await fetch('/v0/management/usage');
        const data = await response.json();
        const usage = data.usage;

        document.getElementById('total-tokens').textContent = usage.total_tokens.toLocaleString();
        document.getElementById('total-requests').textContent = usage.total_requests.toLocaleString();

        // Count models
        const claudeModels = Object.keys(usage.apis.claude.models || {}).filter(k => usage.apis.claude.models[k]);
        const geminiModels = Object.keys(usage.apis.gemini.models || {}).filter(k => usage.apis.gemini.models[k]);

        document.getElementById('claude-models').textContent = claudeModels.length;
        document.getElementById('gemini-models').textContent = geminiModels.length;

        // Load system status
        loadSystemStatus();

        // Load chart
        loadChart();
      } catch (error) {
        console.error('Error loading data:', error);
      }
    }

    async function loadSystemStatus() {
      try {
        const [authRes, debugRes, statsRes, logRes] = await Promise.all([
          fetch('/v0/management/get-auth-status'),
          fetch('/v0/management/debug'),
          fetch('/v0/management/usage-statistics-enabled'),
          fetch('/v0/management/request-log')
        ]);

        const auth = await authRes.json();
        const debug = await debugRes.json();
        const stats = await statsRes.json();
        const log = await logRes.json();

        document.getElementById('auth-status').textContent = auth.authenticated ? t('authenticated') : t('not-authenticated');
        document.getElementById('debug-mode').textContent = debug.debug ? t('enabled') : t('disabled');
        document.getElementById('stats-enabled').textContent = stats['usage-statistics-enabled'] ? t('enabled') : t('disabled');
        document.getElementById('logging').textContent = log['request-log'] ? t('enabled') : t('disabled');
      } catch (error) {
        console.error('Error loading system status:', error);
      }
    }

    async function loadChart() {
      try {
        const response = await fetch('/v0/management/stats/trends');
        const data = await response.json();
        const trends = data.trends || [];

        const ctx = document.getElementById('usageChart').getContext('2d');

        // Destroy existing chart if it exists
        if (usageChartInstance) {
          usageChartInstance.destroy();
        }

        usageChartInstance = new Chart(ctx, {
          type: 'line',
          data: {
            labels: trends.map(t => t.date),
            datasets: [{
              label: currentLanguage === 'en' ? 'Token Usage' : 'Token ‰ΩøÁî®Èáè',
              data: trends.map(t => t.tokens),
              borderColor: '#667eea',
              backgroundColor: 'rgba(102, 126, 234, 0.1)',
              tension: 0.4,
              fill: true,
              pointRadius: 5,
              pointBackgroundColor: '#667eea',
              pointBorderColor: '#fff',
              pointBorderWidth: 2,
              pointHoverRadius: 7
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  color: '#667eea',
                  font: {
                    size: 14,
                    weight: 'bold'
                  },
                  padding: 15
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  color: '#999',
                  font: {
                    size: 12
                  }
                },
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)'
                }
              },
              x: {
                ticks: {
                  color: '#999',
                  font: {
                    size: 12
                  }
                },
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)'
                }
              }
            }
          }
        });
      } catch (error) {
        console.error('Error loading chart:', error);
      }
    }

    // Initialize
    window.addEventListener('load', () => {
      // Set initial language button state
      document.getElementById('btn-en').classList.toggle('active', currentLanguage === 'en');
      document.getElementById('btn-zh').classList.toggle('active', currentLanguage === 'zh');

      updateLanguage();
      loadData();

      // Refresh data every 30 seconds
      setInterval(loadData, 30000);
    });
  </script>
</body>
</html>
